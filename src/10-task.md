# Задание 10 – Задача о рюкзаке

## Условие

Придумать задачу о рюкзаке на 6 типов предметов, где каждый предмет имеет свою стоимость и вес.  
Грузоподъемность рюкзака произвольная.  
Решить задачу динамическим программированием.

## Постановка задачи

Пусть у нас есть рюкзак вместимостью 20 единиц и 6 типов предметов с весами  
[2, 5, 8, 3, 7, 4]  
и соответствующими ценностями  
[3, 8, 6, 7, 10, 5].  
Необходимо выяснить, как наполнить рюкзак предметами так, чтобы суммарная ценность была максимально возможной и при этом суммарный вес не превышал 20. При условии, что каждый тип предметов доступен в неограниченном количестве.

## Решение

Для решения мы строим таблицу DP размерности (n+1) × (capacity+1), где n – число типов предметов, а capacity – грузоподъемность (20).  
– Строки (от 0 до n) соответствуют рассмотрению этих типов: строка 0 означает “не берем никакие предметы”, а строка i (1 ≤ i ≤ n) означает, что рассматриваем первые i типов.  
– Столбцы (от 0 до 20) соответствуют вместимости рюкзака от 0 до 20.

Обозначим dp[i][w] как максимальную ценность, которую можно достичь, используя предметы со 1-го по i-й тип при ограничении вместимости равном w. Поскольку каждый тип можно брать несколько раз, мы используем формулу “неограниченного” рюкзака:

1. Если вес w_i текущего предмета i (i-1 в индексах массива) больше доступной вместимости w, мы не можем взять этот предмет:  
   dp[i][w] = dp[i-1][w]
2. Иначе сравниваем:  
   – Не брать предмет i: dp[i-1][w]  
   – Взять предмет i и остаться на той же строке i (потому что можно брать несколько раз), добавляя ценность values[i-1] и уменьшая доступное w на weights[i-1]:  
   dp[i][w] = values[i-1] + dp[i]\[w - weights[i-1]]

Тогда фактическое значение dp[i][w] – это максимум из двух указанных вариантов. По окончании мы смотрим dp[n][capacity], где n – количество типов, capacity = 20.

Ниже приведены промежуточные таблицы DP, которые показывают, как меняются значения при пополнении рюкзака предметами. Столбцы соответствуют каждой единице грузоподъемности (от 0 до 20), а строки – разным наборам предметов (от 0 до 6). Ячейка (i, w) хранит максимальную ценность с учетом предметов i типов при емкости w.

Каждый раз, когда при добавлении нового предмета улучшалось значение ячейки dp[i][w], это отражалось в таблице с выделением цвета. В конце строки i (т. е. когда мы обработали все вместимости от 1 до capacity для i-го предмета), показывается итоговое состояние на этом шаге.

### Шаги решения

#### Таблица после обработки предмета 1

Здесь предмет №1 (вес 2, ценность 3). При вместимости 2 впервые появляется новая ценность 3 (можно взять один предмет весом 2), и далее при больших w значение возрастает, так как предмет можно брать повторно.

(Две таблицы: при w=2 и при w=20)

Таблица DP после обработки предмета 1 при вместимости 2:

$$
\begin{tabular}{|l|l|l|>{\columncolor[HTML]{98FB98}}l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\rowcolor[HTML]{E0FFFF}
        1 & 0 & 0 & \cellcolor[HTML]{BDFDCC}3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

Таблица DP после обработки предмета 1 при вместимости 20:

$$
\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\rowcolor[HTML]{E0FFFF}
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & \cellcolor[HTML]{BDFDCC}30 \\ \hline
        2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

#### Таблица после обработки предмета 2

Предмет №2 (вес 5, ценность 8). При небольших w (меньше 5) использование этого предмета невозможно, поэтому dp не меняется. Но при w ≥ 5 мы начинаем сравнивать “не брать предмет 2” и “взять предмет 2 (еще раз)”. В частности, при w=5 мы видим ценность 8, что выше предыдущего значения (6), и обновляем таблицу.

(Две таблицы: при w=5 и при w=20)

Таблица DP после обработки предмета 2 при вместимости 5:

$$
\begin{tabular}{|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
\rowcolor[HTML]{E0FFFF}
        2 & 0 & 0 & 3 & 3 & 6 & \cellcolor[HTML]{BDFDCC}8 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

Таблица DP после обработки предмета 2 при вместимости 20:

$$
\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
\rowcolor[HTML]{E0FFFF}
        2 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & \cellcolor[HTML]{BDFDCC}32 \\ \hline
        3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

#### Таблица после обработки предмета 3

Предмет №3 (вес 8, ценность 6). Снова сравниваем, что выгоднее: брать этот предмет (возможно несколько раз) или пропустить. Выясняется, что на больших w (особенно при w=20) итоговая ценность не превышает уже достигнутого уровня (32), поэтому итог в dp[3][20] по-прежнему 32.

Таблица DP после обработки предмета 3 при вместимости 20:

$$
\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
        2 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
\rowcolor[HTML]{E0FFFF}
        3 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & \cellcolor[HTML]{BDFDCC}32 \\ \hline
        4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

#### Таблица после обработки предмета 4

Предмет №4 (вес 3, ценность 7). При небольшой вместимости (от 1 до 2) взять нельзя, а начиная с w=3 появляется возможность брать предмет №4. Он даёт ценность 7 вместо прежних 3 (или 6), что создаёт улучшения в dp. Идём по всей вместимости до 20, обновляя значения. Итог: dp[4][20] = 45. Теперь это новый рекорд.

Таблица DP после обработки предмета 4 при вместимости 3:

$$
\begin{tabular}{|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
        2 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
        3 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
\rowcolor[HTML]{E0FFFF}
        4 & 0 & 0 & 3 & \cellcolor[HTML]{BDFDCC}7 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

Таблица DP после обработки предмета 4 при вместимости 20:

$$
\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
        2 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
        3 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
\rowcolor[HTML]{E0FFFF}
        4 & 0 & 0 & 3 & 7 & 7 & 10 & 14 & 14 & 17 & 21 & 21 & 24 & 28 & 28 & 31 & 35 & 35 & 38 & 42 & 42 & \cellcolor[HTML]{BDFDCC}45 \\ \hline
        5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

#### Таблица после обработки предмета 5

Предмет №5 (вес 7, ценность 10). Итоговая ценность при вместимости 20 не превышает уже достигнутого уровня (45).

Таблица DP после обработки предмета 5 при вместимости 20:

$$
\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
        2 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
        3 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
        4 & 0 & 0 & 3 & 7 & 7 & 10 & 14 & 14 & 17 & 21 & 21 & 24 & 28 & 28 & 31 & 35 & 35 & 38 & 42 & 42 & 45 \\ \hline
\rowcolor[HTML]{E0FFFF}
        5 & 0 & 0 & 3 & 7 & 7 & 10 & 14 & 14 & 17 & 21 & 21 & 24 & 28 & 28 & 31 & 35 & 35 & 38 & 42 & 42 & \cellcolor[HTML]{BDFDCC}45 \\ \hline
        6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
\end{tabular}
$$

#### Таблица после обработки предмета 6

Предмет №6 (вес 4, ценность 5). Аналогичная процедура. По результату, при w=20 ценность по-прежнему 45, то есть этот предмет не дал улучшений сверх уже достигнутого.

Таблица DP после обработки предмета 6 при вместимости 20:

$$
\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|>{\columncolor[HTML]{98FB98}}l|}
\hline
        \diagbox{i}{w} & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 & 20 \\ \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
        1 & 0 & 0 & 3 & 3 & 6 & 6 & 9 & 9 & 12 & 12 & 15 & 15 & 18 & 18 & 21 & 21 & 24 & 24 & 27 & 27 & 30 \\ \hline
        2 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
        3 & 0 & 0 & 3 & 3 & 6 & 8 & 9 & 11 & 12 & 14 & 16 & 17 & 19 & 20 & 22 & 24 & 25 & 27 & 28 & 30 & 32 \\ \hline
        4 & 0 & 0 & 3 & 7 & 7 & 10 & 14 & 14 & 17 & 21 & 21 & 24 & 28 & 28 & 31 & 35 & 35 & 38 & 42 & 42 & 45 \\ \hline
        5 & 0 & 0 & 3 & 7 & 7 & 10 & 14 & 14 & 17 & 21 & 21 & 24 & 28 & 28 & 31 & 35 & 35 & 38 & 42 & 42 & 45 \\ \hline
\rowcolor[HTML]{E0FFFF}
        6 & 0 & 0 & 3 & 7 & 7 & 10 & 14 & 14 & 17 & 21 & 21 & 24 & 28 & 28 & 31 & 35 & 35 & 38 & 42 & 42 & \cellcolor[HTML]{BDFDCC}45 \\ \hline
\end{tabular}
$$

## Итоговое решение

• В итоговой строке dp[6][20] (учитывая 6 типов предметов и вместимость 20) получаем значение 45. Это означает, что при использовании перечисленных предметов нам удалось достичь максимальной суммарной ценности 45.  
• Для восстановления, какие именно предметы формируют эту ценность 45, при w=20 и i=6 мы проверяем, совпадает ли dp[i][w] с dp[i]\[w – weights[i-1]] + values[i-1]. Если да, значит мы взяли предмет i и уменьшаем w на его вес. Если нет, переходим к i-1. В результате получаем набор индексов выбранных предметов, что в конце указан как [4, 4, 4, 4, 4, 4, 1], т. е. несколько раз предмет №4 и один раз предмет №1.

Оптимальное значение: 45  
Выбранные предметы: [4, 4, 4, 4, 4, 4, 1]

Данные предметы можно интерпретировать так:  
• Предмет 4 имеет вес 3 и ценность 7. Взяв его 6 раз, мы потратим вес 18 (6×3 = 18) и получим ценность 42 (6×7 = 42).  
• Остаётся 2 единицы вместимости (20 – 18 = 2), куда поместили предмет №1 (вес 2, ценность 3).  
• Итого получаем вес 20 и ценность 45.

## Вывод

В задаче с неограниченным использованием предметов оптимальное заполнение рюкзака массой 20 даёт суммарную ценность 45. Детальное построение таблиц DP показывает, как постепенно добавляются предметы и пересматриваются решения.

## Код программы

Таблицы выше были сгенерированы с помощью следующего кода:

```python
def backpack(capacity, weights, values):
    """Solve the unbounded knapsack problem using dynamic programming."""
    n = len(weights)
    dp = [[0] * (capacity + 1) for _ in range(n + 1)]

    for i in range(1, n + 1):
        row_changed = False
        for w in range(1, capacity + 1):
            if weights[i - 1] <= w:
                dp[i][w] = max(dp[i - 1][w], values[i - 1] + dp[i][w - weights[i - 1]])
            else:
                dp[i][w] = dp[i - 1][w]

            if dp[i][w] != dp[i - 1][w] and not row_changed:
                row_changed = True
                print_dp_table(dp, i, w)

        print_dp_table(dp, i, capacity)

    print(f"Оптимальное значение: {dp[n][capacity]}  ")
    trace_optimal_solution(dp, weights, values, capacity)


def trace_optimal_solution(dp, weights, values, capacity):
    """Backtrack to find which items were chosen in the optimal solution."""
    n = len(weights)
    w = capacity
    selected = []
    i = n
    while i > 0:
        if (
            w >= weights[i - 1]
            and dp[i][w] == dp[i][w - weights[i - 1]] + values[i - 1]
        ):
            selected.append(i)
            w -= weights[i - 1]
        else:
            i -= 1
    print("Выбранные предметы:", selected)


def print_dp_table(dp, i, w):
    """Print current state of the DP table."""
    print(f"Таблица DP после обработки предмета {i} при вместимости {w}:\n")
    print("$$")
    columns = [
        ">{\\columncolor[HTML]{98FB98}}l" if j == w + 1 else "l"
        for j in range(len(dp[0]) + 1)
    ]
    print("\\begin{tabular}{|" + "|".join(columns) + "|}")

    print("\\hline")
    print(
        "\t"
        + "\\diagbox{i}{w} & "
        + " & ".join(str(i) for i in range(len(dp[0])))
        + " \\\\ \\hline"
    )
    for ind, row in enumerate(dp):
        if ind == i:
            print("\\rowcolor[HTML]{E0FFFF}")
        print(f"\t{ind} & ", end="")
        values = [
            (
                "\\cellcolor[HTML]{BDFDCC}" + str(cell)
                if cell == dp[i][w] and i == ind
                else str(cell)
            )
            for cell in row
        ]
        print(" & ".join(values), end="")
        print(" \\\\ \\hline")
    print("\\end{tabular}")
    print("$$")
    print()


if __name__ == "__main__":
    capacity = 20
    weights = [2, 5, 8, 3, 7, 4]
    values = [3, 8, 6, 7, 10, 5]
    backpack(capacity, weights, values)
```
