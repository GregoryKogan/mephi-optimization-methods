# Задание №9 - Задача о распределении ресурсов

## Условие

Придумать задачу о распределении ресурсов размерности $6 \times 6$.  
То есть в задаче имеется ресурс в количестве 6 единиц, который должен быть распределен между 6 предприятиями.  
Диапазон значений в матрице доходности не ограничен (но не может быть отрицательных элементов).

Решить задачу динамическим программированием.

В отчёт добавить решение задачи с помощью программных средств.

## Постановка задачи

$S = 6$ - количество имеющихся ресурсов.

$n = 6$ - количество предприятий.

Использование $j$-ым предприятием $i$ единиц
ресурса дает доход, определяемый значением нелинейной функции $f_j(i) = f_{ij}$. Обычно значения функции $f_j(i)$ задаются в виде матрицы доходности $F = \|f_{ij}\|_{(S+1) \times n}$.
Зададим матрицу доходности $F$ в виде таблицы:

$$
\begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    \backslashbox{Ресурсы}{Предприятие} & 1 & 2 & 3  & 4 & 5  & 6  \\
    \hline
    0 & 0 & 0 & 0 & 0 & 0 & 0 \\ \hline
    1 & 4 & 9 & 7 & 7 & 9 & 6 \\ \hline
    2 & 6 & 9 & 6 & 6 & 7 & 3 \\ \hline
    3 & 3 & 3 & 8 & 7 & 5 & 3 \\ \hline
    4 & 5 & 2 & 5 & 5 & 3 & 6 \\ \hline
    5 & 7 & 3 & 3 & 2 & 5 & 6 \\ \hline
    6 & 2 & 6 & 9 & 2 & 9 & 5 \\ \hline
\end{tabular}
$$

Пусть мы $j$-ому предприятию выделили $x_j$ единиц ресурса, тогда доход от этого предприятия будет равен $f_j(x_j)$, а весь доход от всех предприятий будет равен  
$F = \sum\limits_{j=1}^{n} f_j(x_j)$.

Требуется распределить ресурсы между предприятиями так, чтобы общий доход был максимальным:

$$
F \to \max
\text{ при условии }
\begin{cases}
\sum\limits_{j=1}^{n} x_j = S \\
x_j \in \mathbb{N}_0 \forall j=\overline{1, n}
\end{cases}
$$

## Динамическое программирование

$\phi_1(x)=\max\{f_1(x_1) \colon x_1 \in \overline{0,x}\}$

$\phi_1(0)=0, x_1^0=0$  
$\phi_1(1)=4, x_1^0=1$  
$\phi_1(2)=6, x_1^0=2$  
$\phi_1(3)=6, x_1^0=2$  
$\phi_1(4)=6, x_1^0=2$  
$\phi_1(5)=7, x_1^0=5$  
$\phi_1(6)=7, x_1^0=5$

$\phi_2(x)=\max\{f_2(x_2) + \phi_1(x - x_2) : x_2 \in \overline{0, x}\}$  
Текущее множество: $(4, 9)$ $\phi_2(1)=9, x_2^0=1$  
Текущее множество: $(6, 13, 9)$ $\phi_2(2)=13, x_2^0=1$  
Текущее множество: $(6, 15, 13, 3)$ $\phi_2(3)=15, x_2^0=1$  
Текущее множество: $(6, 15, 15, 7, 2)$ $\phi_2(4)=15, x_2^0=1$  
Текущее множество: $(7, 15, 15, 9, 6, 3)$ $\phi_2(5)=15, x_2^0=1$  
Текущее множество: $(7, 16, 15, 9, 8, 7, 6)$ $\phi_2(6)=16, x_2^0=1$

$\phi_3(x)=\max\{f_3(x_3) + \phi_2(x - x_3) : x_3 \in \overline{0, x}\}$  
Текущее множество: $(9, 7)$ $\phi_3(1)=9, x_3^0=0$  
Текущее множество: $(13, 16, 6)$ $\phi_3(2)=16, x_3^0=1$  
Текущее множество: $(15, 20, 15, 8)$ $\phi_3(3)=20, x_3^0=1$  
Текущее множество: $(15, 22, 19, 17, 5)$ $\phi_3(4)=22, x_3^0=1$  
Текущее множество: $(15, 22, 21, 21, 14, 3)$ $\phi_3(5)=22, x_3^0=1$  
Текущее множество: $(16, 22, 21, 23, 18, 12, 9)$ $\phi_3(6)=23, x_3^0=3$

$\phi_4(x)=\max\{f_4(x_4) + \phi_3(x - x_4) : x_4 \in \overline{0, x}\}$  
Текущее множество: $(9, 7)$ $\phi_4(1)=9, x_4^0=0$  
Текущее множество: $(16, 16, 6)$ $\phi_4(2)=16, x_4^0=0$  
Текущее множество: $(20, 23, 15, 7)$ $\phi_4(3)=23, x_4^0=1$  
Текущее множество: $(22, 27, 22, 16, 5)$ $\phi_4(4)=27, x_4^0=1$  
Текущее множество: $(22, 29, 26, 23, 14, 2)$ $\phi_4(5)=29, x_4^0=1$  
Текущее множество: $(23, 29, 28, 27, 21, 11, 2)$ $\phi_4(6)=29, x_4^0=1$

$\phi_5(x)=\max\{f_5(x_5) + \phi_4(x - x_5) : x_5 \in \overline{0, x}\}$  
Текущее множество: $(9, 9)$ $\phi_5(1)=9, x_5^0=0$  
Текущее множество: $(16, 18, 7)$ $\phi_5(2)=18, x_5^0=1$  
Текущее множество: $(23, 25, 16, 5)$ $\phi_5(3)=25, x_5^0=1$  
Текущее множество: $(27, 32, 23, 14, 3)$ $\phi_5(4)=32, x_5^0=1$  
Текущее множество: $(29, 36, 30, 21, 12, 5)$ $\phi_5(5)=36, x_5^0=1$  
Текущее множество: $(29, 38, 34, 28, 19, 14, 9)$ $\phi_5(6)=38, x_5^0=1$

$\phi_6(x)=\max\{f_6(x_6) + \phi_5(x - x_6) : x_6 \in \overline{0, x}\}$  
Текущее множество: $(9, 6)$ $\phi_6(1)=9, x_6^0=0$  
Текущее множество: $(18, 15, 3)$ $\phi_6(2)=18, x_6^0=0$  
Текущее множество: $(25, 24, 12, 3)$ $\phi_6(3)=25, x_6^0=0$  
Текущее множество: $(32, 31, 21, 12, 6)$ $\phi_6(4)=32, x_6^0=0$  
Текущее множество: $(36, 38, 28, 21, 15, 6)$ $\phi_6(5)=38, x_6^0=1$  
Текущее множество: $(38, 42, 35, 28, 24, 15, 5)$ $\phi_6(6)=42, x_6^0=1$

$(6 \rightarrow 1, S=6)$
$(5 \rightarrow 1, S=5)$
$(4 \rightarrow 1, S=4)$
$(3 \rightarrow 1, S=3)$
$(2 \rightarrow 1, S=2)$
$(1 \rightarrow 1, S=1)$  
$x^o=(1, 1, 1, 1, 1, 1)$  
$4+9+7+7+9+6 = 42$

## Программное решение

```python
def print_latex_phi_formula(number):
    print(rf"$\phi_{number}(x)=\max\{{f_{number}(x_{number}) + \phi_{number - 1}(x - x_{number}) : x_{number} \in \overline{{0, x}}\}}$")


def print_phi_result(number, x, phi, x_, matrix):
    set_ = [matrix[i][number] + phi[number - 1][x - i] for i in range(x + 1)]
    print(f"Текущее множество: ${tuple(set_)}$", end=' ')
    print(fr"$\phi_{number}({x})={phi[number][x]}, x_{number}^0={x_[number][x]}$")


def print_xo_values(i, x_, S):
    print(f"$({i} \\rightarrow {x_[i][S]}, S={S})$")


def print_final_result(matrix, x_o, phi, N):
    print(f"$x^o=({', '.join(map(str, x_o[1:]))})$")
    print("$" + "+".join(str(matrix[x_o[i]][i]) for i in range(1, N + 1)) + f" = {phi[N][N]}$")


def initialize_phi_x_(n):
    phi = [[0] * n for _ in range(n)]
    x_ = [[0] * n for _ in range(n)]
    return phi, x_


def compute_phi_1(matrix, n, phi, x_):
    print(r"$\phi_1(x)=\max\{f_1(x_1) \colon x_1 \in \overline{0,x}\}$")
    print()
    for x in range(n):
        set_ = [matrix[i][1] for i in range(x + 1)]
        for item_number in range(len(set_)):
            if set_[item_number] > set_[x_[1][x]]:
                x_[1][x] = item_number
        phi[1][x] = max(phi[1][x - 1], matrix[x][1])
        print(fr"$\phi_1({x})={phi[1][x]}, x_1^0={x_[1][x]}$")
    print()


def compute_phi_n(matrix, n, phi, x_):
    for number in range(2, n):
        print_latex_phi_formula(number)
        for x in range(1, n):
            set_ = [matrix[i][number] + phi[number - 1][x - i] for i in range(x + 1)]
            for item_number in range(len(set_)):
                if set_[item_number] > set_[x_[number][x]]:
                    x_[number][x] = item_number
            phi[number][x] = max(set_)
            print_phi_result(number, x, phi, x_, matrix)
        print()


def backtrack_solution(n, phi, x_):
    S = n
    i = n
    x_o = [0] * (n + 1)
    while S > 0:
        print_xo_values(i, x_, S)
        x_o[i] = x_[i][S]
        S -= x_[i][S]
        i -= 1
    return x_o


if __name__ == "__main__":
    N = 6
    n = N + 1
    matrix = [
        [0, 0, 0, 0, 0, 0, 0],
        [1, 4, 9, 7, 7, 9, 6],
        [2, 6, 9, 6, 6, 7, 3],
        [3, 3, 3, 8, 7, 5, 3],
        [4, 5, 2, 5, 5, 3, 6],
        [5, 7, 3, 3, 2, 5, 6],
        [6, 2, 6, 9, 2, 9, 5]
    ]

    phi, x_ = initialize_phi_x_(n)
    compute_phi_1(matrix, n, phi, x_)
    compute_phi_n(matrix, n, phi, x_)
    x_o = backtrack_solution(N, phi, x_)
    print_final_result(matrix, x_o, phi, N)
```
